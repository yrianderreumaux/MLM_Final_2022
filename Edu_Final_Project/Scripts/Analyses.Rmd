---
title: "Analyses"
author: "Yrian Derreumaux"
date: "5/19/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_knit$set(root.dir = '/tmp')
```

```{r}
library(ordinal)
library(ggeffects)
library(dplyr)
```


# Check Packages 

```{r}
#snapshot shows all libraries #https://rstudio.github.io/packrat/walkthrough.html
packrat::snapshot()
```

# get data
```{r}
#accessing data from google drive
#authenticate 
# drive_auth()
#check account accessed
# drive_user()

#uncomment below if we want to download to local repository
#locate folder with data
#file_url <- "https://drive.google.com/drive/u/1/folders/1lKMwv_Xf7AGQO5fuSwTlPbzV9Vr6lqLt/SharedDFfullDF.csv"
#save id
#to save files to local repository
# folder <- drive_get(as_id(file_url))
# csv_files <- drive_ls(folder, type = "csv")
# walk(csv_files$id, ~ drive_download(as_id(.x)))

#below to read in from google drive but not download
df <- read.csv("../input/PFfullDF.csv")
```

```{r}
varReduced <- function(reference, compare){
  output <- (reference - compare)/reference
  return(output)
}
```


# Information and Polling Approval

## Null Model: One-Way ANOVA

```{r}
null <-  clmm(as.factor(eval) ~ 1 + (1|subID) + (1|issues), data = df, threshold = "flexible")
summary(null)

performance::icc(null)

Null.COV <- VarCorr(null)
Null.InterceptVar.SubID <- Null.COV$subID[1]
Null.InterceptVar.Issues <- Null.COV$issues[1]
```

## Means-As-Outcomes: i.e., L1-Only with Fixed Slopes

```{r}
MAO <-  clmm(as.factor(eval) ~ scale(inMinOut) + (1|subID) + (1|issues), data = df, threshold = "flexible")
summary(MAO)

performance::icc(MAO)

MAO.VCOV <- VarCorr(MAO)
MAO.InterceptVar.SubID <- MAO.VCOV$subID[1]
MAO.InterceptVar.Issues <- MAO.VCOV$issues[1]
```

### # Intercept Variance Reduced for People

```{r}
varReduced(Null.InterceptVar.SubID, MAO.InterceptVar.SubID)
```

### # Intercept Variance Reduced for Issues

```{r}
varReduced(Null.InterceptVar.Issues, MAO.InterceptVar.Issues)
```

## One-Way ANCOVA: i.e., L1-Only with Random Slopes

```{r}
ANCOVA <-  clmm(as.factor(eval) ~ scale(inMinOut) + (scale(inMinOut)|subID) + (1|issues), data = df, threshold = "flexible")
summary(ANCOVA)

performance::icc(ANCOVA)

ANCOVA.VCOV <- VarCorr(ANCOVA)
ANCOVA.InterceptVar.SubID <- ANCOVA.VCOV$subID[1]
ANCOVA.InterceptVar.Issues <- ANCOVA.VCOV$issues[1]


ANCOVA.SlopeVar.SubID <- ANCOVA.VCOV$subID[4]
ANCOVA.SlopeVar.Issues <- ANCOVA.VCOV$issues[4]
```

### # Intercept Variance Reduced for People

```{r}
varReduced(MAO.InterceptVar.SubID, ANCOVA.InterceptVar.SubID)
```

### # Intercept Variance Reduced for Issues

```{r}
varReduced(MAO.InterceptVar.Issues, ANCOVA.InterceptVar.Issues)
```

## Means-and-slopes-as-outcomes: i.e., L1 with Random Slopes and L2 cross-level

```{r}
MASAO <-  clmm(as.factor(eval) ~ Info * scale(inMinOut) + (scale(inMinOut)|subID) + (1|issues), data = df, threshold = "flexible")
summary(MASAO)

performance::icc(MASAO)

MASAO.VCOV <- VarCorr(MASAO)
MASAO.InterceptVar.SubID <- MASAO.VCOV$subID[1]
MASAO.InterceptVar.Issues <- MASAO.VCOV$issues[1]

MASAO.SlopeVar.SubID <- MASAO.VCOV$subID[4]
MASAO.SlopeVar.Issues <- MASAO.VCOV$issues[4]
```

### # Intercept Variance Reduced for People

```{r}
varReduced(ANCOVA.InterceptVar.SubID, MASAO.InterceptVar.SubID)
```

### # Intercept Variance Reduced for Issues

```{r}
varReduced(ANCOVA.InterceptVar.Issues, MASAO.InterceptVar.SubID)
```

### # Slope Variance Reduced for People

```{r}
varReduced(ANCOVA.SlopeVar.SubID, MASAO.SlopeVar.SubID)
```

